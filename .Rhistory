coordinates(soil_csv) <- ~ x + y
proj4string(soil_csv) <- CRS("+init=epsg:4326")
head(soil_csv)
plot(soil_csv, add =T, pch = 18, col ="red")
plot(covariates_RS$NDVI, main = "NDVI")
plot(soil_csv, add =T, pch = 18, col ="red")
identicalCRS(covariates_RS, study_area, soil_csv)
identicalCRS(covariates_RS, study_area)
crs(covariates_RS)
crs(study_area)
crs(soil_csv)
?identicalCRS(covariates_RS, study_area)
identicalCRS(covariates_RS, study_area)
identicalCRS(covariates_RS, soil_csv)
class(covariates_RS)
class(study_area)
class(soil_csv)
proj4string(covariates_RS)
proj4string(study_area)
proj4string(soil_csv)
proj4string(covariates_RS) == proj4string(study_area)
proj4string(covariates_RS) == proj4string(soil_csv)
plot(study_area, add = T)
plot(study_area)
plot(covariates_RS$NDVI, main = "NDVI" , add = T)
plot(soil_csv, add =T, pch = 18, col ="red")
plot(soil_csv, add =T, pch = 18, col ="red")
plot(soil_csv, pch = 18, col ="red")
plot(study_area, add = T)
plot(covariates_RS$NDVI, main = "NDVI" , add = T)
plot(soil_csv, pch = 18, add = T, col ="red")
# check directory
getwd()
png("plots/covariates_plot.png", width = 800, height = 600)
dev.off()
png("plots/covariates_plot.png", width = 800, height = 600)
plot(covariates_RS$NDVI, main = "NDVI")
plot(study_area, add = T)
plot(soil_csv, pch = 18, add = T, col ="red")
dev.off()
png("plots/covariates_plot.png", width = 800, height = 600)
plot(covariates_RS$NDVI, main = "NDVI")
plot(study_area, add = T)
plot(soil_csv, pch = 18, add = T, col ="blue")
dev.off()
png("plots/NDVI_Messpunkte_Boundaries_plot.png", width = 800, height = 600)
plot(covariates_RS$NDVI, main = "NDVI")
plot(study_area, add = T)
plot(soil_csv, pch = 18, add = T, col ="blue")
dev.off()
res(covariates_RS)
res(covariates_RS[[1]]) == res(covariates_RS[[2]])
res(covariates_RS[[3]]) == res(covariates_RS[[7]])
class(covariates_RS)
# Kovariablen laden, benennen (automatische Benennung hat nicht geklappt) & Koordinatensystem zuweisen
Blue <- raster("./Covariates/Blue.tif")
res(Blue)
names(covariates_RS)
# Kovariablen laden, benennen (automatische Benennung hat nicht geklappt) & Koordinatensystem zuweisen
C <- raster("./Covariates/Catchment_Area.tif")
res(C)
# Kovariablen laden, benennen (automatische Benennung hat nicht geklappt) & Koordinatensystem zuweisen
C <- raster("./Covariates/Wetness_Index.tif")
res(C)
# Kovariablen laden, benennen (automatische Benennung hat nicht geklappt) & Koordinatensystem zuweisen
C <- raster("./Covariates/Slope.tif")
res(C)
plot(covariates_RS$NDVI, main = "NDVI")
plot(study_area, add = T)
plot(soil_csv, pch = 19, add = T, col ="blue")
ggplot(cov_soil, aes(x = CEC)) +
geom_histogram(bins = 30, fill = "steelblue", color = "black") +
theme_minimal() +
labs(title = "Histogramm der CEC-Werte",
x = "CEC",
y = "Häufigkeit")
# Extraktion der Kovariaten an den Messpunkten
cov = extract(covariates_RS, soil_csv, method='bilinear', df=TRUE)
# Kombination der Kovariate mit der CEC (Zielvariable)
cov_soil = cbind(cov[,-1], CEC=soil_csv$CEC)
str(cov_soil)
summary(cov_soil$CEC)
library(ggplot2)
ggplot(cov_soil, aes(x = CEC)) +
geom_histogram(bins = 30, fill = "steelblue", color = "black") +
theme_minimal() +
labs(title = "Histogramm der CEC-Werte",
x = "CEC",
y = "Häufigkeit")
cov_soil <- cov_soil[cov_soil$CEC<60,]
trainIndex <- createDataPartition(cov_soil$CEC, p = 0.8, list = FALSE, times = 1)
# subset the datasets
cov_soil_Train <- cov_soil[ trainIndex,]
cov_soil_Test  <- cov_soil[-trainIndex,]
# fit random forest model
rf_fit <- randomForest(CEC ~ Aspect+Blue+Catchment_Area+Channel_Network+Elevation+Green+LS_Factor+NDVI+NIR+Rainfall+Red+Slope+SWIR1+SWIR2+Temprature+Valley_Depth+Wetness_Index,
data = cov_soil_Train, ntree = 1000, do.trace = 50) #Cor: 1.7
# fit random forest model
rf_fit <- randomForest(CEC ~ Aspect+Blue+Catchment_Area+Channel_Network+Elevation+Green+LS_Factor+NDVI+NIR+Rainfall+Red+Slope+SWIR1+SWIR2+Temperature+Valley_Depth+Wetness_Index,
data = cov_soil_Train, ntree = 1000, do.trace = 50) #Cor: 1.7
summary(rf_fit)
# variable importance
importance(rf_fit)
varImpPlot(rf_fit, main = "Variable Importance for RF model")
CEC_rf_Pred <- predict(rf_fit, cov_soil_Test)
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
rf_fit <- randomForest(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temprature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train, ntree = 10000) #Cor: 2.1
rf_fit <- randomForest(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train, ntree = 10000) #Cor: 2.1
summary(rf_fit)
# variable importance
importance(rf_fit)
varImpPlot(rf_fit, main = "Variable Importance for RF model")
CEC_rf_Pred <- predict(rf_fit, cov_soil_Test)
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
cov_soil <- cov_soil[cov_soil$CEC<50,] #Test!
trainIndex <- createDataPartition(cov_soil$CEC, p = 0.8, list = FALSE, times = 1)
# subset the datasets
cov_soil_Train <- cov_soil[ trainIndex,]
cov_soil_Test  <- cov_soil[-trainIndex,]
# inspect the two datasets
str(cov_soil_Train)
str(cov_soil_Test)
# fit random forest model
rf_fit <- randomForest(CEC ~ Aspect+Blue+Catchment_Area+Channel_Network+Elevation+Green+LS_Factor+NDVI+NIR+Rainfall+Red+Slope+SWIR1+SWIR2+Temperature+Valley_Depth+Wetness_Index,
data = cov_soil_Train, ntree = 1000, do.trace = 50) #Cor: 1.7
rf_fit <- randomForest(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train, ntree = 10000) #Cor: 2.1
rf_fit <- randomForest(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train, ntree = 10000) #Cor: 2.1
summary(rf_fit)
# variable importance
importance(rf_fit)
varImpPlot(rf_fit, main = "Variable Importance for RF model")
CEC_rf_Pred <- predict(rf_fit, cov_soil_Test)
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
cov_soil <- cov_soil[cov_soil$CEC<45,] #Test!
trainIndex <- createDataPartition(cov_soil$CEC, p = 0.8, list = FALSE, times = 1)
# subset the datasets
cov_soil_Train <- cov_soil[ trainIndex,]
cov_soil_Test  <- cov_soil[-trainIndex,]
# inspect the two datasets
str(cov_soil_Train)
str(cov_soil_Test)
rf_fit <- randomForest(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train, ntree = 10000) #Cor: 2.1
summary(rf_fit)
# variable importance
importance(rf_fit)
varImpPlot(rf_fit, main = "Variable Importance for RF model")
CEC_rf_Pred <- predict(rf_fit, cov_soil_Test)
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
# Extraktion der Kovariaten an den Messpunkten
cov = extract(covariates_RS, soil_csv, method='bilinear', df=TRUE)
# Kombination der Kovariate mit der CEC (Zielvariable)
cov_soil = cbind(cov[,-1], CEC=soil_csv$CEC)
str(cov_soil)
trainIndex <- createDataPartition(cov_soil$CEC, p = 0.8, list = FALSE, times = 1)
# subset the datasets
cov_soil_Train <- cov_soil[ trainIndex,]
cov_soil_Test  <- cov_soil[-trainIndex,]
# inspect the two datasets
str(cov_soil_Train)
str(cov_soil_Test)
rf_fit <- randomForest(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train, ntree = 10000) #Cor: 2.1
# variable importance
importance(rf_fit)
varImpPlot(rf_fit, main = "Variable Importance for RF model")
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
CEC_rf_Pred <- predict(rf_fit, cov_soil_Test)
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
# random forest prediction part
map_rf <- raster::predict(covariates_RS, rf_fit)
# plot the RF map
spplot(map_rf, main = "CEC map based on RF model")
R2_RF <- 1 - sum((cov_soil_Test$CEC - CEC_rf_Pred)^2)/sum((cov_soil_Test$CEC - mean(cov_soil_Test$CEC))^2)
R2_RF
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
View(cov_soil_Test)
View(cov_soil_Test)
# rf performance
RMSE_RF <- sqrt(mean((cov_soil_Test$CEC - CEC_rf_Pred)^2))
RMSE_RF
R2_RF <- 1 - sum((cov_soil_Test$CEC - CEC_rf_Pred)^2)/sum((cov_soil_Test$CEC - mean(cov_soil_Test$CEC))^2)
R2_RF
# random forest prediction part
map_rf <- raster::predict(covariates_RS, rf_fit)
# plot the RF map
spplot(map_rf, main = "CEC map based on RF model")
# empty workspace
rm(list = ls())
# check directory
getwd()
# loading libraries
library(sp)
library(raster)
library(sf)
library(caret)
library(randomForest)
library (ggplot2)
covariates_RS <- stack(list.files("./Covariates/", pattern="\\.tif$", full.names = TRUE))
names(covariates_RS) <- tools::file_path_sans_ext(
basename(list.files("./Covariates/", pattern="\\.tif$", full.names = FALSE)))
names(covariates_RS)
covariates_RS  <- projectRaster(covariates_RS, crs = CRS("+init=epsg:4326"))
plot(covariates_RS)
# Import der Grenzen des Untersuchungsgebiets
study_area <- as(st_read("./GIS/boundary.shp"), "Spatial")
study_area     <- spTransform(study_area, CRS("+init=epsg:4326"))
# Import der .csv SOIL Daten & Umwandlung in räumliche Daten (Koordinaten + Koordinatensystem)
soil_csv <- read.csv("./Soil/soil.csv", header = TRUE)
coordinates(soil_csv) <- ~ x + y
proj4string(soil_csv) <- CRS("+init=epsg:4326")
head(soil_csv)
png("plots/NDVI_Messpunkte_Boundaries_plot.png", width = 800, height = 600)
plot(covariates_RS$NDVI, main = "NDVI")
plot(study_area, add = T)
plot(soil_csv, pch = 19, add = T, col ="blue")
dev.off()
# Extraktion der Kovariaten an den Messpunkten
cov = extract(covariates_RS, soil_csv, method='bilinear', df=TRUE)
# Kombination der Kovariate mit der CEC (Zielvariable)
cov_soil = cbind(cov[,-1], CEC=soil_csv$CEC)
str(cov_soil)
trainIndex <- createDataPartition(cov_soil$CEC, p = 0.8, list = FALSE, times = 1)
# subset the datasets
cov_soil_Train <- cov_soil[ trainIndex,]
cov_soil_Test  <- cov_soil[-trainIndex,]
# inspect the two datasets
str(cov_soil_Train)
str(cov_soil_Test)
# fit random forest model
rf_fit <- randomForest(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train, ntree = 10000) #Cor: 2.1
# variable importance
importance(rf_fit)
varImpPlot(rf_fit, main = "Variable Importance for RF model")
CEC_rf_Pred <- predict(rf_fit, cov_soil_Test)
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
rf_fit <- randomForest(CEC ~ Aspect+Blue+Catchment_Area+Channel_Network+Elevation+Green+LS_Factor+NDVI+NIR+Rainfall+Red+Slope+SWIR1+SWIR2+Temperature+Valley_Depth+Wetness_Index,
data = cov_soil_Train, ntree = 1000, do.trace = 50) #Cor: 1.7
CEC_rf_Pred <- predict(rf_fit, cov_soil_Test)
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
View(cov_soil)
R2_RF <- 1 - sum((cov_soil_Test$CEC - CEC_rf_Pred)^2)/sum((cov_soil_Test$CEC - mean(cov_soil_Test$CEC))^2)
R2_RF
ctrl <- trainControl(method = "cv", number = 10)
rfGrid1 <- expand.grid(.mtry = 3)
set.seed(1234)
rf_fit1 <- train(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train,
method = "rf",
trControl = ctrl,
tuneGrid = rfGrid1,
ntree = 200)
rf_fit1$finalModel
ctrl <- trainControl(method = "cv", number = 10)
rfGrid1 <- expand.grid(.mtry = (3:6))
set.seed(1234)
rf_fit1 <- train(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train,
method = "rf",
trControl = ctrl,
tuneGrid = rfGrid1,
ntree = 500)
rf_fit1$finalModel
CEC_rf_Pred <- predict(rf_fit1, cov_soil_Test)
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
CEC_rf_Pred1 <- predict(rf_fit1, cov_soil_Test)
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred1, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
rf_fit <- randomForest(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train, ntree = 10000) #Cor: 2.1
CEC_rf_Pred <- predict(rf_fit, cov_soil_Test)
# check the plot actual and predicted OC values
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
View(soil_csv)
View(soil_csv)
# Kombination der Kovariate mit der CEC (Zielvariable)
cov_soil = cbind(cov[,-1], CEC=soil_csv$CEC, Clay = soil_csv$Clay)
str(cov_soil)
View(cov_soil)
cor_test <- cor(cov_soil$CEC, cov_soil$Clay)
cor_test
View(soil_csv)
# Kombination der Kovariate mit der CEC (Zielvariable)
cov_soil = cbind(cov[,-1], CEC=soil_csv$CEC, Clay = soil_csv$Clay, SOC = soil_csv$SOC)
str(cov_soil)
View(cov_soil)
cor_test <- cor(cov_soil$CEC, cov_soil$SOC)
cor_test
# Kombination der Kovariate mit der CEC (Zielvariable)
cov_soil = cbind(cov[,-1], CEC=soil_csv$CEC, Clay = soil_csv$Clay, SOC = soil_csv$SOC, pH = soil_csv$pH)
cor_test <- cor(cov_soil$CEC, cov_soil$pH)
cor_test
cor_test <- cor(cov_soil$CEC, cov_soil$SOC)
cor_test
# Extraktion der Kovariaten an den Messpunkten
cov = extract(covariates_RS, soil_csv, method='bilinear', df=TRUE)
# Kombination der Kovariate mit der CEC (Zielvariable)
cov_soil = cbind(cov[,-1], CEC=soil_csv$CEC, Clay = soil_csv$Clay, SOC = soil_csv$SOC, pH = soil_csv$pH)
rf_fitX <- randomForest(SOC ~ Aspect+Blue+Catchment_Area+Channel_Network+Elevation+Green+LS_Factor+NDVI+NIR+Rainfall+Red+Slope+SWIR1+SWIR2+Temperature+Valley_Depth+Wetness_Index,
data = cov_soil_Train, ntree = 1000, do.trace = 50) #Cor: 1.7
trainIndexX <- createDataPartition(cov_soil$SOC, p = 0.8, list = FALSE, times = 1)
# subset the datasets
cov_soil_TrainX <- cov_soil[ trainIndex,]
cov_soil_TestX  <- cov_soil[-trainIndex,]
rf_fitX <- randomForest(SOC ~ Aspect+Blue+Catchment_Area+Channel_Network+Elevation+Green+LS_Factor+NDVI+NIR+Rainfall+Red+Slope+SWIR1+SWIR2+Temperature+Valley_Depth+Wetness_Index,
data = cov_soil_TrainX, ntree = 1000, do.trace = 50) #Cor: 1.7
importance(rf_fitX)
varImpPlot(rf_fitX, main = "Variable Importance for RF model")
CEC_rf_PredX <- predict(rf_fitX, cov_soil_TestX)
cor_rfX <- cor(cov_soil_TestX$SOC, CEC_rf_PredX)
cor_rfX
rf_fitX <- randomForest(SOC ~ Aspect+Blue+Catchment_Area+Channel_Network+Elevation+LS_Factor+NDVI+Rainfall+Slope+SWIR1+Valley_Depth+Wetness_Index,
data = cov_soil_TrainX, ntree = 1000, do.trace = 50) #Cor:
importance(rf_fitX)
varImpPlot(rf_fitX, main = "Variable Importance for RF model")
CEC_rf_PredX <- predict(rf_fitX, cov_soil_TestX)
cor_rfX <- cor(cov_soil_TestX$SOC, CEC_rf_PredX)
cor_rfX
rf_fitX <- randomForest(SOC ~ Aspect+Blue+Catchment_Area+Channel_Network+Elevation+Green+LS_Factor+NDVI+NIR+Rainfall+Red+Slope+SWIR1+SWIR2+Temperature+Valley_Depth+Wetness_Index,
data = cov_soil_TrainX, ntree = 1000, do.trace = 50) #Cor:
importance(rf_fitX)
varImpPlot(rf_fitX, main = "Variable Importance for RF model")
CEC_rf_PredX <- predict(rf_fitX, cov_soil_TestX)
cor_rfX <- cor(cov_soil_TestX$SOC, CEC_rf_PredX)
cor_rfX
rf_fit <- randomForest(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train, ntree = 10000) #Cor: 2.1
# variable importance
importance(rf_fit)
varImpPlot(rf_fit, main = "Variable Importance for RF model")
CEC_rf_Pred <- predict(rf_fit, cov_soil_Test)
#### check the plot actual and predicted OC values ###################
plot(cov_soil_Test$CEC, CEC_rf_Pred, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred)
cor_rf
ctrl <- trainControl(method = "cv", number = 10)
rfGrid1 <- expand.grid(.mtry = (3:6))
set.seed(1234)
rf_fit1 <- train(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train,
method = "rf",
trControl = ctrl,
tuneGrid = rfGrid1,
ntree = 500)
rf_fit1$finalModel
CEC_rf_Pred1 <- predict(rf_fit1, cov_soil_Test)
#### check the plot actual and predicted OC values ###################
plot(cov_soil_Test$CEC, CEC_rf_Pred1, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred1)
cor_rf
ctrl <- trainControl(method = "cv", number = 10)
rfGrid1 <- expand.grid(.mtry = 6)
set.seed(1234)
rf_fit1 <- train(CEC ~ Aspect+Catchment_Area+Channel_Network+Elevation+Green+Temperature+LS_Factor+NDVI+NIR+Rainfall+Slope+SWIR1+Wetness_Index,
data = cov_soil_Train,
method = "rf",
trControl = ctrl,
tuneGrid = rfGrid1,
ntree = 1000)
CEC_rf_Pred1 <- predict(rf_fit1, cov_soil_Test)
#### check the plot actual and predicted OC values ###################
plot(cov_soil_Test$CEC, CEC_rf_Pred1, main="Tree model",
col="blue",xlab="Actual CEC", ylab="Predicted CEC", xlim=c(0,100),ylim=c(0,100))
abline(coef = c(0,1),  col="red" )
# calculate correlation
cor_rf <- cor(cov_soil_Test$CEC, CEC_rf_Pred1)
cor_rf
# random forest prediction part
map_rf <- raster::predict(covariates_RS, rf_fit)
# plot the RF map
spplot(map_rf, main = "CEC map based on RF model")
# append residuals
cov_soil$residuals <- cov_soil$CEC - CEC_rf_Pred
names(cov_soil)
View(cov_soil)
# append residuals
cov_soil$residuals <- cov_soil$CEC - CEC_rf_Pred
names(cov_soil)
summary(cov_soil)
# histogram of the residuals
hist(cov_soil$residuals, col = "lightblue")
# convert cov_soil to spatial data
cov_soil$x <- soil_csv$x
cov_soil$y <- soil_csv$y
coordinates(cov_soil) <- ~ x + y
proj4string(cov_soil) <- CRS("+init=epsg:4326")
# compute experimental semivariogram of residuals
#install.packages(gstat)
library(gstat)
gstat_res <- gstat(formula = residuals ~ 1, data = cov_soil)
vg_res    <- variogram(gstat_res)
plot(vg_res, plot.nu = FALSE)
# define initial semivariogram model
vg_parameters_res <- vgm(nugget = 70, psill = 100, range = 100, model = "Pen")
plot(vg_res, vg_parameters_res)
# define initial semivariogram model
vg_parameters_res <- vgm(nugget = 70, psill = 110, range = 100, model = "Pen")
plot(vg_res, vg_parameters_res)
# fit semivariogram model
vg_model_res <- fit.variogram(vg_res, vg_parameters_res)
plot(vg_res, vg_model_res)
vg_model_res
# export boundary as a grid (approx. 90 m)
res(covariates_RS)
# export boundary as a grid
res(covariates_RS)
# export boundary as a grid
r_template <- raster(study_area, res = 0.00898)                 # template raster
r_mask     <- rasterize(study_area, r_template, field = 1) # inside polygon = 1, outside = NA
study_area_grid <- as(r_mask, "SpatialPixelsDataFrame")    # grid for kriging
# ordinary kriging of residuals
res_krig <- krige(
formula   = residuals ~ 1,
locations = cov_soil,
newdata   = study_area_grid,
model     = vg_model_res
)
spplot(res_krig, zcol = "var1.pred", main = "residuals predictions")
# obtain regression kriging prediction
res_krig_raster <- raster::resample(raster(res_krig), map_rf)
RK_map <-     res_krig_raster +  map_rf ##evtl. umdrehen!?
# rk performance
RK_pred <- extract(RK_map, cov_soil)
RMSE_RK <- sqrt(mean((cov_soil$CEC - RK_pred)^2))
RMSE_RK
MAE_RK <- mean(abs(cov_soil$CEC - RK_pred))
MAE_RK
R2_RK <- 1 - sum((cov_soil$CEC - RK_pred)^2) / sum((cov_soil$CEC - mean(cov_soil$CEC))^2)
R2_RK
# plot the RK map
spplot(map_rf, main = "CEC map based on RF model")
spplot(RK_map, main = "CEC map based on RK model")
